<h1 id="agromo-project">AgroMo project</h1>
<h2 id="introduction">Introduction</h2>
<p>AgroMo is an Integrated Assessment and Modelling software that integrates 4M (Fodor et al. 2014) a CERES based crop model, the Biome-BGCMuSo (Hidy et al. 2016) biogeochemical and a simple agro-economical model in order to support decision makers at multiple scales.</p>
<h2 id="install-agromo">Install AgroMo</h2>
<p>AgroMo GUI uses the freely available Fira Sans font family. Please, install the font in order to obtain proper outlook. The font is available <a href="https://fonts.google.com/specimen/Fira+Sans">here</a>.</p>
<h3 id="using-installer">Using Installer</h3>
<p><a href="https://owncloud.atk.hu/index.php/s/7ODCTJU8qPpckUs/download">Direct link to the Installer</a></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
AgroMo does not require installation, actually. Download the Installer that is practically a zipped AgroMo folder.</li>
<li><input type="checkbox" disabled="" checked="" />
Unzip/extract the AgroMo folder to any (convenient) location on your PC. Note: there is no need to create an extra AgroMo or any other folder before extracting. Though, you may decide to use another main folder (e.g. MyAgroMo). In this case, copy/extract the content of the zipped AgroMo folder into your folder.</li>
<li><input type="checkbox" disabled="" checked="" />
AgroMo starts with .\AgroMo\AgroMo_Launch.exe and by clicking the [LAUNCH AGROMO] button.</li>
</ul>
<h2 id="agromo-user-interface">AgroMo User Interface</h2>
<p>A graphical user interface (GUI) has been developed for providing easy and user friendly access to the functions of the AgroMo system. When lunching the AgroMo App the user meets the AgroMo Base form first.</p>
<h3 id="agromo-base">AgroMo Base</h3>
<p><img src="img/base_gui.png" title="AgroMo Base" alt="alt text" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
Choose/change the main directory where your data files are located (in the required <a href="img/AgroMo_File_System.pdf">subdirectory system</a>) by clicking the [MODIFY] button. The default location is the AgroMo\data folder.</li>
<li><input type="checkbox" disabled="" checked="" />
Run the model for a specific site/plot by clicking the [SITE] button.</li>
<li><input type="checkbox" disabled="" checked="" />
Create plots of the simulation results by clicking the [PLOT] button.</li>
<li><input type="checkbox" disabled="" checked="" />
Make gridded model runs by clicking the [GRID] button.</li>
<li><input type="checkbox" disabled="" checked="" />
Present the results of a gridded simulation on a map by clicking the [MAP] button.</li>
<li><input type="checkbox" disabled="" checked="" />
Carry out Sensitivity analysis, Parameter sweep or Parameter calibration by clicking the [PARAMETER ANALYSIS] button.</li>
<li><input type="checkbox" disabled="" checked="" />
Import weather and soil data from international databases into local input files by clicking the [INPUT IMPORT] button.</li>
<li><input type="checkbox" disabled="" checked="" />
Create storyline and corresponding input files for gridded model runs by clicking the [INPUT CREATOR] button.</li>
<li><input type="checkbox" disabled="" checked="" />
Select GUI language by click one of the flag icons to the right. Hungarian, English and German versions are available at the moment.</li>
<li><input type="checkbox" disabled="" checked="" />
Exit AgroMo by clicking the EXIT icon on the banner to the left.</li>
</ul>
<h3 id="agromo-site">AgroMo Site</h3>
<p><img src="img/site_gui.png" title="AgroMo Site" alt="alt text" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
The dropdown menus display the files, only with the prescribed extension, of the corresponding directories within the prescribed input folder system:<ul>
<li>INI files (extension: .ini): .\input\initialization\site\</li>
<li>WEATHER files (extension: .wth): .\input\weather\site\</li>
<li>SOIL files (extension: .soi): .\input\soil\site\</li>
<li>MANAGEMENT files (extension: .mgm): .\input\management\site\
<ul>
<li>planting management option file (extension: .plt): .\input\management\site\planting\</li>
<li>harvest management option file (extension: .hrv): .\input\management\site\harvest\</li>
<li>fertilization management option file (extension: .frz): .\input\management\site\fertilization\</li>
<li>irrigation management option file (extension: .irr): .\input\management\site\irrigation\</li>
<li>cultivation management option file (extension: .cul): .\input\management\site\cultivation\</li>
<li>grazing management option file (extension: .grz): .\input\management\site\grazing\</li>
<li>mowing management option file (extension: .mow): .\input\management\site\mowing\</li>
<li>thinning management option file (extension: .thn): .\input\management\site\thinning\</li>
</ul></li>
<li>PLANT specific input files (extension: .epc; folder: .\input\plant) are referred to in the planting files</li>
</ul></li>
<li><input type="checkbox" disabled="" checked="" />
When selecting an INI file the WEATHER, SOIL and MANAGEMENT files that are referred to in the INI file are automatically selected from the corresponding dropdown menus, but those could be changed freely any time.</li>
<li><input type="checkbox" disabled="" checked="" />
In case new INI, WEATHER, SOIL, MANAGEMENT, etc. files are placed to the corresponding folders of the file system, click the green [REFRESH] button to see the new files in the corresponding dropdown menus.</li>
<li><input type="checkbox" disabled="" checked="" />
When selecting a MANAGEMENT file the management option files that are referred to in the MANAGEMENT file are automatically selected from the corresponding dropdown menus, but those could be changed freely any time.</li>
<li><input type="checkbox" disabled="" checked="" />
The most important parameters of the management options could be changed without accessing the management option file by adjusting the input values using the corresponding textboxes within the 'shift in...' section. Negative values could also be used.</li>
<li><input type="checkbox" disabled="" checked="" />
Give a name to the simulation run in the 'OUTPUT DATA TABLE' textbox. Output data are stored in an SQLite data table using the name defined in the textbox.</li>
<li><input type="checkbox" disabled="" checked="" />
After selecting the desired input files and optionally set up the changes in the 'shift in...' section simulation starts by clicking the [START SIMULATION] button.</li>
<li><input type="checkbox" disabled="" checked="" />
An activity indicator is on while the simulation is running.</li>
<li><input type="checkbox" disabled="" checked="" />
To see simulation results on graphs click the [PLOT] button.</li>
<li><input type="checkbox" disabled="" checked="" />
Navigate to the [BASE], [GRID] or [MAP] component by clicking the corresponding button on the banner to the left.</li>
<li><input type="checkbox" disabled="" checked="" />
In case at least one GRID run has already been carried out, grid cell specific outputs can be retrieved and plotted by (1) setting the SITE/GRID switch to grid state, (2) selecting the OUTPUT DATABASE table, and the (3) CELL id, (4) setting the name of the OUTPUT DATA TABLE, and finally clicking the [RETRIEVE CELL DATA] button.</li>
</ul>
<h3 id="agromo-plot">AgroMo Plot</h3>
<p><img src="img/plot_gui.png" title="AgroMo Plot" alt="alt text" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
Select a maximum of 5 simulation results from the left side list by clicking the items. Clicking again deselects the item.</li>
<li><input type="checkbox" disabled="" checked="" />
Select output variable(s) from the right side list for presenting them on the plot(s).</li>
<li><input type="checkbox" disabled="" checked="" />
Enter an alias for the observed data to be presented on the graph.</li>
<li><input type="checkbox" disabled="" checked="" />
Observed data could be added to the plots by selecting the data file from the corrresponding dropdown lists. NOTE, that data in the observed data tables should be structured according to prescribed rules. Observed (experimental) data should be stored in the '.\observation' folder in a semicolon separated text file with .obs extension. var_id, date and mean (of the observations) values are compulsory for each record, optionally followed by the sd, min and max of the observed values.</li>
<li><input type="checkbox" disabled="" checked="" />
For each selected output variable select:<ul>
<li>a |time step| for which the daily data are to be aggregated into one single value (e.g. for presenting annual values the 'year' option should be selected).</li>
</ul>
- a |function| that defines the aggregation (e.g. for presenting the final yield for each year the 'max' option should be selected)
<ul>
<li>a |plot type|</li>
</ul></li>
</ul>
<p>- [x] Options in the |time step|, |function| and |plot type| columns can be selected via circular menus operated by clicking/scrolling in the corresponding cells.</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
Having all the desired options selected, create plot(s) by clicking the [CREATE PLOT] button.</li>
<li><input type="checkbox" disabled="" checked="" />
Output variables can be filtered accoording to a couple of predefined tags, that may be edited in the centralData.json file.</li>
</ul>
<p><img src="img/plotly_graph01.png" title="AgroMo Graph" alt="alt text" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
Zoom in the graph by selecting an area on the graph while holding down the left mouse button.</li>
<li><input type="checkbox" disabled="" checked="" />
Move the x/y axes by dragging them in the middle (cursor changes) and move the pointer horizontally/vertically.</li>
<li><input type="checkbox" disabled="" checked="" />
Expand/Contract the x/y axes by dragging the end of the axis (cursor changes) and move the pointer horizontally/vertically.</li>
<li><input type="checkbox" disabled="" checked="" />
Hide/Expose a curve on the plot by clicking the corresponding label in the legend.</li>
<li><input type="checkbox" disabled="" />
Export plot data into various file formats (e.g. xlsx, csv) by clicking the [EXPORT] button.</li>
<li><input type="checkbox" disabled="" checked="" />
Navigate to the [BASE], [SITE], [GRID] or [MAP] component by clicking the corresponding button on the banner to the left.</li>
</ul>
<h3 id="agromo-grid">AgroMo Grid</h3>
<p><img src="img/grid_gui.png" title="AgroMo Grid" alt="alt text" /></p>
<p>As an INI file controls a site specific simulation, a STORY file defines a whole STORYLINE for a gridded simulation. A STORYLINE is set of INI file sets: comprises a set/series of INI files for every individual cells in the grid. A STORYLINE defines what happens, where and when in the grid inlcuding changes in crop rotation or even land use changes facilitated by INI file changes. In a STORY file all the grid cells are listed and for each cell a series of INI files are listed with an indication of the start and end years when the INI file needs to be activated and deactivated.</p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
Select climate database to provide daily weather data for the simulations.</li>
<li><input type="checkbox" disabled="" checked="" />
Select soil database to provide physical and chemical soil parameters for the simulations.</li>
<li><input type="checkbox" disabled="" checked="" />
Select algorythm combos defining calculation methods of photosynthesis, potential evapotranspiration and water stress</li>
<li><input type="checkbox" disabled="" />
In case an ensemble checkbox is checked simulations are carried out with all available options</li>
<li><input type="checkbox" disabled="" checked="" />
Provide a name for the output data table in which the simulation results are stored. The results of each simulation are stored in separate data tables of the grid.db SQLite database.</li>
<li><input type="checkbox" disabled="" checked="" />
In case the annual outputs checkbox is checked only annual outputs are stored. In case it is unchecked daily outputs are stored in the data table.</li>
<li><input type="checkbox" disabled="" checked="" />
Click the [START SIMULATION] button to start the simulation. All available (minus one) threads are used for the calculations.</li>
</ul>
<h4 id="queries">Queries:</h4>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
Each item in the QUERIES list stands for an SQL sentence in which key sections were made to be selectable. After choosing a query, set/finalize the SQL sentence by picking items from the available {1}, {2}, etc. dropdown menus. You may select the data table the query is applied for; you may select the time frame you want to focus on; and/or you may select the aggregation function (max, min, mean, etc.) you want to apply on the data the SELECT SQL statement retrieved from the data table.</li>
</ul>
<p>An example that retrieves the average annual Net Primary Production for each grid cell for a given time period from the results of the TestRun simulation:</p>
<ul>
<li>Raw query item: {1} annual NPP in the [T-T] period for model output {2}</li>
<li>Finalized query item: {1: mean} annual NPP in the [1981-2010] period for model output {2: TestRun}</li>
<li>SQL sentence: SELECT plotid, AVG(cNPP) FROM (SELECT MAX(cumNPP) AS cNPP, plotid, year FROM TestRun WHERE year &gt;= 1981 AND year &lt;= 2010 GROUP BY year, plotid) GROUP BY plotid</li>
</ul>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
New, self made SQL sentences can be added to the system by placing properly formatted .json files to the .\data\template\grid\ folder.</li>
<li><input type="checkbox" disabled="" checked="" />
Provide an alias/name and a short description for your query and click the [QUERY] or the [REPORT] button to run the query. The first option (if possible) results in a datafile that can be presented as a gridded map, while the secong option results in a simple data table that can be viewed (it is automatically saved).</li>
<li><input type="checkbox" disabled="" checked="" />
Click the [MAP] button to create gridded maps of simulation results.</li>
</ul>
<h3 id="agromo-map">AgroMo Map</h3>
<p><img src="img/map_gui.png" title="AgroMo Map" alt="alt text" /></p>
<ul class="task-list">
<li><input type="checkbox" disabled="" checked="" />
Query results are stored in .sql files that can be selected from the data source drop down menu. Data in an .sql file usually define a gridded map.</li>
<li><input type="checkbox" disabled="" checked="" />
Set some basic features of the map by selecting a palette, switching on/off the the country contour and the latitude/longitude lines, selecting a color for the masked cells.</li>
<li><input type="checkbox" disabled="" checked="" />
Two options can be selected for creating the map: 1) select the number of colors to be used on the map; 2) define an interval that will be used to partitioning the range of the presented values and define the range by setting the minimum and maximum values to be presented on the map. Note: the max-min difference should be larger than the interval.</li>
<li><input type="checkbox" disabled="" checked="" />
Set the number of decimal places for the values to be presented on the map.</li>
<li><input type="checkbox" disabled="" checked="" />
Provide a map title and click the [CREATE MAP] button.</li>
<li><input type="checkbox" disabled="" checked="" />
A preview map is presented that can enlarged by clicking it. A larger resolution version of the map (.png) is automatically saved in the .\data\output\map_image\ folder.</li>
</ul>
<h2 id="install-agromo-1">Install AgroMo</h2>
<p>AgroMo GUI uses the freely available Fira Sans font family. Please, install the font in order to obtain proper outlook. The font is available <a href="https://fonts.google.com/specimen/Fira+Sans">here</a>.</p>
<h3 id="using-pure-r">Using pure R</h3>
<p>AgroMo can be used from your browser with your current R installation. The package can be installed in the following way:</p>
<pre class="{r}"><code>install.packages(&quot;remotes&quot;) # if you have already installed devtools or remotes, skip this step.
remotes::install_github(&quot;hollorol/AgroMo&quot;, upgrade = &quot;never&quot;) # You can replace remotes with devtools.</code></pre>
<p>After the installation process, the application starts with the following command:</p>
<pre class="{r}"><code>AgroMo::launchApp()</code></pre>
